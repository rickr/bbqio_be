<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/epoch.min.css">
    <title>Dashboard</title>
    <script src="js/jquery-2.1.3.min.js"></script>
  </head>

  <body>
    <div id="areaChart" class="epoch category10" style="height: 200px;"></div>

    <script src="js/d3.min.js"></script>
    <script src="js/epoch.min.js"></script>
    <script type='text/javascript'>
      $(document).ready(function(){
        var currentTime = Math.floor(Date.now() / 1000);
        var meatChamberTempGraph = $('#areaChart').epoch({
          type: 'time.area',
          data: [
            {label: 'ChamberTemp', values: [{time: currentTime, y: 0}]},
            {label: 'MeatTemp', values: [{time: currentTime, y: 0}]}
          ],
          axes: ['left', 'right', 'bottom']
        });


        window.ws           = new WebSocket('ws://' + window.location.host + '/sensor_data');
        window.ws.onopen    = function()  { console.log('WS opened'); }
        window.ws.onclose   = function()  { console.log('WS Closed'); }
        window.ws.onmessage = function(m) {
          var dataPoints = $.parseJSON(m.data);

          var realMeatTemp = dataPoints.chamberTemp - dataPoints.meatTemp;
          var realChamberTemp = dataPoints.chamberTemp - realMeatTemp;
          console.log(realChamberTemp);
          console.log(realMeatTemp);
          meatChamberTempGraph.push([
              {time: dataPoints.timestamp, y: parseFloat(realChamberTemp)},
              {time: dataPoints.timestamp, y: parseFloat(realMeatTemp)}
          ]);
        };
      });
    </script>
  </body>

</html>
